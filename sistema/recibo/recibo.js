var logoBPH = "data:image/png;base64,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";

function ImagetoPrint(source){
    return "<html><head><scri"+"pt>function step1(){\n" +
            "setTimeout('step2()', 10);}\n" +
            "function step2(){window.print();window.close()}\n" +
            "</scri" + "pt><style>body{margin: 0px;}</style></head><body onload='step1()'>\n" +
            "<img src='" + source + "' /></body></html>";
}

function PrintImage(source){
    var Pagelink = "about:blank";
    var pwa = window.open(Pagelink, "_new");
    pwa.document.open();
    pwa.document.write(ImagetoPrint(source));
    pwa.document.close();
}

function LimitText(text, width, canvas){
    var ctx = canvas.getContext('2d'); 
    var result = String(text);
    while(ctx.measureText(result).width > width){
        result = result.substring(0, result.length - 1);
    }
    if(String(text).length !== result.length){
        result = result.substring(0, result.length - 3) + "...";
    }
    return result;
}

function appendImageInCanvas(url, x, y, width, height, canvas){
    return new Promise(function(resolve){
        var ctx = canvas.getContext("2d");
    
        var image = new Image();
        image.onload = function(){
            ctx.drawImage(image, x, y, width, height);
            resolve(canvas, image);
        };
        image.src = url;
    });
}

function roundRect(ctx, x, y, width, height, radius, fill, stroke){
    if(typeof stroke === 'undefined'){
        stroke = true;
    }
    if(typeof radius === 'undefined'){
        radius = 5;
    }
    if(typeof radius === 'number'){
        radius = {tl: radius, tr: radius, br: radius, bl: radius};
    }else{
        var defaultRadius = {tl: 0, tr: 0, br: 0, bl: 0};
        for(var side in defaultRadius){
            radius[side] = radius[side] || defaultRadius[side];
        }
    }
    ctx.beginPath();
    ctx.moveTo(x + radius.tl, y);
    ctx.lineTo(x + width - radius.tr, y);
    ctx.quadraticCurveTo(x + width, y, x + width, y + radius.tr);
    ctx.lineTo(x + width, y + height - radius.br);
    ctx.quadraticCurveTo(x + width, y + height, x + width - radius.br, y + height);
    ctx.lineTo(x + radius.bl, y + height);
    ctx.quadraticCurveTo(x, y + height, x, y + height - radius.bl);
    ctx.lineTo(x, y + radius.tl);
    ctx.quadraticCurveTo(x, y, x + radius.tl, y);
    ctx.closePath();
    if(fill){
        ctx.fill();
    }
    if(stroke){
        ctx.stroke();
    }
}

async function ImprimirRecibo(tipo, nome, codigo, endereco, regional, data, itens, isPrint){
    var canvas = document.createElement("canvas")
        ctx = canvas.getContext('2d');
    var margin = 10;
    var w = canvas.width = 793-15;
    var h = canvas.height = 1090;
    var mainTop = margin;
    var mainLeft = margin;
    var mainright = w - margin;
    var mainBottom = h/2;

    var length_itens = 22;

    ctx.fillStyle = "#ffffff";
    ctx.fillRect (0, 0, w, h);

    var logoW = 200;
    var logoH = (118*logoW)/427;
    await appendImageInCanvas(logoBPH, mainLeft+5, mainTop+5, logoW, logoH, canvas);

    ctx.font = 'bold 20px Arial';
    ctx.fillStyle = '#212121';
    ctx.textAlign = "left";
    ctx.textBaseline = "hanging";
    ctx.fillText('RECIBO - '+(new Date().getFullYear()), 235, mainTop+14);

    ctx.font = 'bold 26px Arial';
    ctx.fillText('SMED - Secretaria Municipal de Educação', 235, mainTop+40);

    ctx.fillStyle = '#000000';

    var left_box = margin+12;
    var top_box = margin+75;
    var width_box = w-(margin*2)-25;
    var height_box = ((h/2)-(margin*2))-95;
    var right_box = left_box+width_box;
    var bottom_box = top_box+height_box;

    ctx.strokeStyle = '#9e9e9e';
    roundRect(ctx, left_box, top_box, width_box, height_box, 10);
    //ctx.strokeRect(margin, margin+75, w-(margin*2), ((h/2)-(margin*2))-95);

    ctx.font = '16px Arial';
    ctx.fillText('NOME:', left_box+15, top_box+15);

    ctx.font = 'bold 16px Arial';
    ctx.fillText(LimitText(String(nome), 635, canvas), left_box+75, top_box+15);

    if(endereco && typeof endereco === "string"){
        ctx.font = '16px Arial';
        ctx.fillText('ENDEREÇO:', left_box+15, top_box+40);

        ctx.font = 'bold 16px Arial';
        ctx.fillText(LimitText(String(endereco), 600, canvas), left_box+115, top_box+40);

        top_box += 25;
        length_itens = length_itens - 2;
    }

    ctx.font = '16px Arial';
    ctx.fillText(tipo !== 0 ? 'EMPRESA:' : 'CÓDIGO:', left_box+15, top_box+40);

    ctx.font = 'bold 16px Arial';
    ctx.fillText(LimitText(String(codigo), 350, canvas), left_box+100, top_box+40);

    if(tipo !== 0){
        ctx.font = '16px Arial';
        ctx.fillText('REGIONAL:', right_box-240, top_box+40);

        ctx.font = 'bold 16px Arial';
        ctx.fillText(LimitText(String(regional), 190, canvas), right_box-150, top_box+40);
    }else{
        ctx.font = '16px Arial';
        ctx.fillText('REGIONAL:', right_box-440, top_box+40);

        ctx.font = 'bold 16px Arial';
        ctx.fillText(LimitText(String(regional), 190, canvas), right_box-350, top_box+40);

        ctx.font = '16px Arial';
        ctx.fillText('DATA:', right_box-170, top_box+40);

        ctx.font = 'bold 16px Arial';
        data = data && data instanceof Date ? new Date(data) : new Date();
        ctx.fillText((data.toLocaleDateString()), right_box-120, top_box+40);
    }

    roundRect(ctx, left_box+10, top_box+65, width_box-20, 28*((length_itens-2)/2), 10);

    itens = Array.isArray(itens) ? itens : [];

    ctx.fillStyle = '#212121';
    ctx.textAlign = "left";
    ctx.textBaseline = "hanging";

    ctx.strokeStyle = "#9e9e9e";
    ctx.lineCap = "round";
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo((left_box+10)+(width_box/2), top_box+65);
    ctx.lineTo((left_box+10)+(width_box/2), (top_box+65)+(28*((length_itens-2)/2)));
    ctx.stroke();

    for(var i=0; i<length_itens; i++){
        var item = itens[i];
        var left_pos = i%2 === 0 ? left_box : left_box+(width_box/2);
        var right_pos = i%2 === 0 ? left_box+(width_box/2)+(length_itens-2) : right_box;
        var pos = i === 0 ? 0 : Math.floor(i/2);

        if(Array.isArray(item)){
            ctx.font = '12px Arial';
            ctx.textAlign = "left";
            ctx.fillText(LimitText(String(item[0] || ""), 280, canvas), left_pos+30, (top_box+75)+(25*pos));

            ctx.font = 'bold 12px Arial';
            ctx.textAlign = "right";
            ctx.fillText((item[1] || ""), right_pos-30, (top_box+75)+(25*pos));
        }

        if(pos >= 0 && pos < ((length_itens-2)/2)){
            ctx.strokeStyle = "#9e9e9e";
            ctx.lineCap = "round";
            ctx.lineWidth = 1;
            ctx.beginPath();
            ctx.moveTo(left_pos+10, (top_box+91)+(25*pos));
            ctx.lineTo(right_pos-10, (top_box+91)+(25*pos));
            ctx.stroke();
        }
    }

    ctx.textAlign = "left";

    ctx.strokeStyle = "#000000";
    ctx.lineCap = "round";
    ctx.lineWidth = 2;
    ctx.beginPath();
    ctx.moveTo(left_box+20, bottom_box-25);
    ctx.lineTo(left_box+400, bottom_box-25);
    ctx.stroke();

    ctx.font = '10px Arial';
    ctx.textBaseline = "ideographic";
    ctx.fillText("Assinatura do Responsável pelo Recebimento", left_box+100, bottom_box-10);

    ctx.beginPath();
    ctx.moveTo(left_box+430, bottom_box-25);
    ctx.lineTo(left_box+570, bottom_box-25);
    ctx.stroke();

    ctx.font = '10px Arial';
    ctx.textBaseline = "ideographic";
    ctx.fillText("BM-Identidade", left_box+470, bottom_box-10);

    ctx.font = 'bold 25px Arial';
    ctx.textBaseline = "ideographic";
    ctx.fillText("/     /", right_box-110, bottom_box-24);

    ctx.beginPath();
    ctx.moveTo(right_box-140, bottom_box-25);
    ctx.lineTo(right_box-20, bottom_box-25);
    ctx.stroke();

    ctx.font = '10px Arial';
    ctx.textBaseline = "ideographic";
    ctx.fillText("Data", right_box-90, bottom_box-10);

    var imgData = ctx.getImageData(0, 0, w, h/2);
    ctx.putImageData(imgData, 0, (h/2));

    ctx.strokeStyle = "#616161";
    ctx.lineCap = "round";
    ctx.lineWidth = 2;
    ctx.setLineDash([4, 5]);
    ctx.beginPath();
    ctx.moveTo(0, (h/2)-10);
    ctx.lineTo(w, (h/2)-10);
    ctx.stroke();

    if(isPrint){
        PrintImage(canvas.toDataURL());
    }

    document.querySelectorAll("canvas").forEach(function(canvas){
        canvas.parentElement.removeChild(canvas);
    });
    
    document.body.appendChild(canvas);
}

function emitir_recibo(isPrint){
    var params = new URL(location.href).searchParams;
    var imprimir = params.has("imprimir") ? Number(params.get("imprimir")) === 1 : isPrint;
    var nome = params.has("nome") ? String(params.get("nome")) : "";
    var tipo = params.has("tipo") ? Number(params.get("tipo")) : 0;
    var codigo = params.has("codigo") ? String(params.get("codigo")) : "";
    var empresa = params.has("empresa") ? String(params.get("empresa")) : "";
    var endereco = params.has("endereco") ? String(params.get("endereco")) : null;
    var regional = params.has("regional") ? String(params.get("regional")) : "";
    var data = params.has("data") ? String(params.get("data")) : "";
    var itens = params.has("data") ? params.get("itens") : "[]";

    try{
        itens = JSON.parse(itens);
    }catch(e){
        itens = [];
    }

    itens = itens.map(function(e){return e.reverse()});

    data = (/(\d{2})\/(\d{2})\/(\d{4})/).test(data) ? data.match(/(\d{2})\/(\d{2})\/(\d{4})/) : null;

    if(data){
        data = new Date(Number(data[3]), Number(data[2])-1, Number(data[1]));
    }

    ImprimirRecibo(tipo, nome, (tipo !== 0 ? empresa : codigo), endereco, regional, data, itens, isPrint);

    if(imprimir){
        window.print();
        window.open('','_parent','');
        window.close();
    }
}

emitir_recibo(false);
